\<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Habit Tracker</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 1000px; margin: auto; }
    h1 { text-align: center; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    td, th { border: 1px solid #ccc; padding: 6px; text-align: center; }
    .success { background: #c8f7c5; }
    .fail { background: #f7c5c5; }
    .controls { margin: 10px 0; }
    button { padding: 5px 10px; margin: 2px; border: none; cursor: pointer; border-radius: 5px; }
    .btn-add { background: #4CAF50; color: white; }
    .btn-del { background: #F44336; color: white; }
    .btn-success { background: #2ecc71; color: white; }
    .btn-fail { background: #e74c3c; color: white; }
  </style>
</head>
<body>
  <h1>Habit Tracker</h1>

  <div class="controls">
    <input type="text" id="newGoal" placeholder="Tên mục tiêu...">
    <button class="btn-add" onclick="addGoal()">➕ Thêm mục tiêu</button>
  </div>

  <table id="tracker">
    <thead>
      <tr id="headerRow">
        <th>Ngày</th>
      </tr>
    </thead>
    <tbody id="trackerBody"></tbody>
  </table>

  <script>
    const today = new Date();
    const year = today.getFullYear();
    const month = today.getMonth(); // 0-11
    const daysInMonth = new Date(year, month + 1, 0).getDate();

    let goals = JSON.parse(localStorage.getItem("goals") || "[]");
    let habitData = JSON.parse(localStorage.getItem("habitData") || "{}");

    const headerRow = document.getElementById("headerRow");
    const trackerBody = document.getElementById("trackerBody");

    function saveData() {
      localStorage.setItem("goals", JSON.stringify(goals));
      localStorage.setItem("habitData", JSON.stringify(habitData));
    }

    function renderTable() {
      // clear old table
      headerRow.innerHTML = "<th>Ngày</th>";
      trackerBody.innerHTML = "";

      // header goals
      goals.forEach(goal => {
        const th = document.createElement("th");
        th.textContent = goal;
        const delBtn = document.createElement("button");
        delBtn.textContent = "❌";
        delBtn.className = "btn-del";
        delBtn.onclick = () => deleteGoal(goal);
        th.appendChild(delBtn);
        headerRow.appendChild(th);
      });

      // rows per day
      for (let d = 1; d <= daysInMonth; d++) {
        const row = document.createElement("tr");
        row.innerHTML = `<td>${d}/${month+1}</td>`;

        goals.forEach(goal => {
          const cell = document.createElement("td");
          const key = `${year}-${month+1}-${d}-${goal}`;
          const status = habitData[key];
          if (status) cell.classList.add(status);

          const successBtn = document.createElement("button");
          successBtn.textContent = "✅";
          successBtn.className = "btn-success";
          successBtn.onclick = () => setStatus(key, "success", cell);

          const failBtn = document.createElement("button");
          failBtn.textContent = "❌";
          failBtn.className = "btn-fail";
          failBtn.onclick = () => setStatus(key, "fail", cell);

          cell.append(successBtn, failBtn);
          row.appendChild(cell);
        });

        trackerBody.appendChild(row);
      }
    }

    function setStatus(key, status, cell) {
      cell.className = "";
      cell.classList.add(status);
      habitData[key] = status;
      saveData();
    }

    function addGoal() {
      const input = document.getElementById("newGoal");
      const goal = input.value.trim();
      if (goal && !goals.includes(goal)) {
        goals.push(goal);
        saveData();
        renderTable();
      }
      input.value = "";
    }

    function deleteGoal(goal) {
      goals = goals.filter(g => g !== goal);
      // xóa dữ liệu cũ của goal này
      Object.keys(habitData).forEach(k => {
        if (k.endsWith("-" + goal)) delete habitData[k];
      });
      saveData();
      renderTable();
    }

    renderTable();
  </script>
</body>
</html>
